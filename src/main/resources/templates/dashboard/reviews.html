<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì „ì²´ í›„ê¸° - ë¯¸ì…˜ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .card {
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .review-card {
            border-left: 4px solid #007bff;
            transition: transform 0.2s;
        }
        .review-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .star-rating {
            font-size: 1.2rem;
            color: #ffc107;
        }
        .feedback-text {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            border-left: 3px solid #007bff;
            font-style: italic;
        }
        .filter-card {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .stats-badge {
            font-size: 1.1rem;
            padding: 0.5em 1em;
            margin: 0.25em;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container-fluid">
            <a href="/admin/dashboard" class="navbar-brand">ğŸ“Š ë¯¸ì…˜ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</a>
            <span class="navbar-text text-white-50">ì „ì²´ í›„ê¸°</span>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="row">
            <div class="col-md-12">
                <a href="/admin/dashboard" class="btn btn-secondary mb-3">â† ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°</a>
                <h1>ğŸ’¬ ì „ì²´ ì‚¬ìš©ì í›„ê¸°</h1>
            </div>
        </div>

        <!-- í›„ê¸° í†µê³„ -->
        <div class="row mt-3">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">ğŸ“Š í›„ê¸° í†µê³„</h5>
                        <div class="d-flex flex-wrap">
                            <span class="badge bg-primary stats-badge">
                                ì´ í›„ê¸°: <strong th:text="${statistics.totalReviews}">0</strong>ê±´
                            </span>
                            <span class="badge bg-warning text-dark stats-badge">
                                í‰ê·  í‰ì : <strong th:text="${statistics.avgRating}">0.0</strong>ì 
                            </span>
                            <span class="badge bg-success stats-badge">
                                â­â­â­â­â­ <strong th:text="${statistics.rating5Count}">0</strong>ê±´
                            </span>
                            <span class="badge bg-info stats-badge">
                                â­â­â­â­ <strong th:text="${statistics.rating4Count}">0</strong>ê±´
                            </span>
                            <span class="badge bg-secondary stats-badge">
                                â­â­â­ <strong th:text="${statistics.rating3Count}">0</strong>ê±´
                            </span>
                            <span class="badge bg-light text-dark stats-badge">
                                â­â­ <strong th:text="${statistics.rating2Count}">0</strong>ê±´
                            </span>
                            <span class="badge bg-danger stats-badge">
                                â­ <strong th:text="${statistics.rating1Count}">0</strong>ê±´
                            </span>
                            <span class="badge bg-dark stats-badge">
                                í…ìŠ¤íŠ¸ í›„ê¸°: <strong th:text="${statistics.withFeedbackCount}">0</strong>ê±´
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- í•„í„° -->
        <div class="row mt-3">
            <div class="col-md-12">
                <div class="filter-card">
                    <h5>ğŸ” í•„í„°</h5>
                    <form method="get" action="/admin/dashboard/reviews" class="row g-3">
                        <div class="col-md-3">
                            <label for="rating" class="form-label">í‰ì </label>
                            <select name="rating" id="rating" class="form-select" th:value="${selectedRating}">
                                <option value="">ì „ì²´</option>
                                <option value="5" th:selected="${selectedRating == '5'}">â­â­â­â­â­ (5ì )</option>
                                <option value="4" th:selected="${selectedRating == '4'}">â­â­â­â­ (4ì )</option>
                                <option value="3" th:selected="${selectedRating == '3'}">â­â­â­ (3ì )</option>
                                <option value="2" th:selected="${selectedRating == '2'}">â­â­ (2ì )</option>
                                <option value="1" th:selected="${selectedRating == '1'}">â­ (1ì )</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="missionType" class="form-label">ë¯¸ì…˜ íƒ€ì…</label>
                            <select name="missionType" id="missionType" class="form-select" th:value="${selectedMissionType}">
                                <option value="">ì „ì²´</option>
                                <option value="PORTFOLIO" th:selected="${selectedMissionType == 'PORTFOLIO'}">PORTFOLIO</option>
                                <option value="VOCABULARY" th:selected="${selectedMissionType == 'VOCABULARY'}">VOCABULARY</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="hasFeedback" class="form-label">í›„ê¸° ìœ ë¬´</label>
                            <select name="hasFeedback" id="hasFeedback" class="form-select" th:value="${selectedHasFeedback}">
                                <option value="">ì „ì²´</option>
                                <option value="true" th:selected="${selectedHasFeedback == true}">í…ìŠ¤íŠ¸ í›„ê¸° ìˆìŒ</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">&nbsp;</label>
                            <div>
                                <button type="submit" class="btn btn-primary w-100">í•„í„° ì ìš©</button>
                            </div>
                        </div>
                    </form>
                    <div class="mt-2">
                        <a href="/admin/dashboard/reviews" class="btn btn-sm btn-outline-secondary">í•„í„° ì´ˆê¸°í™”</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- í›„ê¸° ëª©ë¡ -->
        <div class="row mt-3">
            <div class="col-md-12">
                <p class="text-muted">ì´ <strong th:text="${reviews.size()}">0</strong>ê°œì˜ í›„ê¸°</p>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12" th:if="${reviews.isEmpty()}">
                <div class="alert alert-info">
                    í•„í„° ì¡°ê±´ì— ë§ëŠ” í›„ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6" th:each="review : ${reviews}">
                <!-- ì™„ë£Œí•œ ë¯¸ì…˜ (í‰ì  ìˆìŒ) -->
                <div class="card review-card" th:if="${review.rating != null}" style="border-left: 4px solid #007bff;">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <span class="star-rating" th:text="${review.starRating}">â­â­â­â­â­</span>
                                <span class="badge bg-secondary ms-2" th:text="${review.ratingText}">ë§¤ìš° ì‰¬ì›€</span>
                            </div>
                            <span class="badge"
                                  th:classappend="${review.missionType.name() == 'PORTFOLIO'} ? 'bg-primary' : 'bg-success'"
                                  th:text="${review.missionType}">
                                PORTFOLIO
                            </span>
                        </div>

                        <h6 class="card-subtitle mb-2 text-muted" th:text="${review.missionName}">í¬íŠ¸í´ë¦¬ì˜¤ ìƒì„± ë¯¸ì…˜</h6>

                        <div th:if="${review.hasFeedback && review.feedback != null && !#strings.isEmpty(review.feedback)}"
                             class="feedback-text mt-3 mb-3">
                            <small class="text-muted">ğŸ’¬ ì‚¬ìš©ì í›„ê¸°:</small><br>
                            <span th:text="${review.feedback}">ë¹„ì¤‘ ì¡°ì •ì´ ì¢‹ì•˜ì–´ìš”</span>
                        </div>

                        <div class="mt-2">
                            <small class="text-muted">
                                <strong>Attempt ID:</strong> <code th:text="${#strings.substring(review.attemptId, 0, 20)} + '...'">attempt_xxx</code>
                            </small>
                        </div>

                        <div class="d-flex justify-content-between align-items-center mt-3">
                            <small class="text-muted">
                                ì†Œìš” ì‹œê°„: <strong th:text="${review.missionDurationFormatted}">6ë¶„ 45ì´ˆ</strong>
                            </small>
                            <small class="text-muted" th:text="${#temporals.format(review.submittedAt, 'yyyy-MM-dd HH:mm')}">
                                2025-01-20 10:30
                            </small>
                        </div>

                        <div class="mt-3">
                            <a th:href="@{/admin/dashboard/attempt/{id}(id=${review.attemptId})}"
                               class="btn btn-sm btn-outline-primary w-100">
                                ë¯¸ì…˜ ìƒì„¸ ë³´ê¸°
                            </a>
                        </div>
                    </div>
                </div>

                <!-- í¬ê¸°í•œ ë¯¸ì…˜ (í¬ê¸° ì‚¬ìœ ) -->
                <div class="card review-card" th:if="${review.rating == null && review.ratingText == 'í¬ê¸°'}" style="border-left: 4px solid #dc3545;">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <span style="font-size: 1.5rem;">ğŸ˜</span>
                                <span class="badge bg-danger ms-2">ë¯¸ì…˜ í¬ê¸°</span>
                            </div>
                            <span class="badge"
                                  th:classappend="${review.missionType.name() == 'PORTFOLIO'} ? 'bg-primary' : 'bg-success'"
                                  th:text="${review.missionType}">
                                PORTFOLIO
                            </span>
                        </div>

                        <h6 class="card-subtitle mb-2 text-muted" th:text="${review.missionName}">í¬íŠ¸í´ë¦¬ì˜¤ ìƒì„± ë¯¸ì…˜</h6>

                        <div th:if="${review.hasFeedback && review.feedback != null && !#strings.isEmpty(review.feedback)}"
                             class="mt-3 mb-3"
                             style="background: #fff5f5; padding: 12px; border-radius: 6px; border-left: 3px solid #dc3545;">
                            <small class="text-muted">ğŸšª í¬ê¸° ì‚¬ìœ :</small><br>
                            <span th:text="${review.feedback}">ë„ˆë¬´ ì–´ë ¤ì›Œì„œ í¬ê¸°í–ˆìŠµë‹ˆë‹¤</span>
                        </div>

                        <div class="mt-2">
                            <small class="text-muted">
                                <strong>Attempt ID:</strong> <code th:text="${#strings.substring(review.attemptId, 0, 20)} + '...'">attempt_xxx</code>
                            </small>
                        </div>

                        <div class="d-flex justify-content-between align-items-center mt-3">
                            <small class="text-muted">
                                ì†Œìš” ì‹œê°„: <strong th:text="${review.missionDurationFormatted}">3ë¶„ 20ì´ˆ</strong>
                            </small>
                            <small class="text-muted" th:text="${#temporals.format(review.submittedAt, 'yyyy-MM-dd HH:mm')}">
                                2025-01-20 10:30
                            </small>
                        </div>

                        <div class="mt-3">
                            <a th:href="@{/admin/dashboard/attempt/{id}(id=${review.attemptId})}"
                               class="btn btn-sm btn-outline-danger w-100">
                                ë¯¸ì…˜ ìƒì„¸ ë³´ê¸°
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4 mb-5">
            <div class="col-md-12 text-center">
                <a href="/admin/dashboard" class="btn btn-primary btn-lg">ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°</a>
            </div>
        </div>

        <div class="row mt-3 mb-5">
            <div class="col-md-12 text-center text-muted">
                <p>Â© 2025 ì¡¸ì—… ì „ì‹œ ì›¹ì•± - ë¯¸ì…˜ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
